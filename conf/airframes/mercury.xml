<airframe name="MERCURY">

<!-- commands section -->

  <servos>
    <servo name="S1" no="0" min="11287" neutral="32768" max="54249"/>
    <servo name="S2" no="1" min="11287" neutral="32768" max="54249"/>
  </servos>

   <csc_boards>
    <board id="0">
      <msg id="SERVO_CMD_ID" type="ServoCmd">
       <field_map field="servos[0]" servo_id="SERVO_S1"/>
       <field_map field="servos[1]" servo_id="SERVO_S2"/>
      </msg>
   </board>
  </csc_boards>

  <section name="PROP_MISC">
    <define name="PROPS_NB" value="4" />
  </section>
  
  <!-- Indexes for mixed commands. -->
  <section name="PROPS" PREFIX="PROP_">
    <define name="UPPER_LEFT"  value="0" />
    <define name="LOWER_RIGHT" value="1" />
    <define name="LOWER_LEFT"  value="2" />
    <define name="UPPER_RIGHT" value="3" />
  </section>

  <section name="MERCURY_SUPERVISION" PREFIX="MERCURY_SUPERVISION_">
    <define name="YAW_SERVO_GAIN" value="20" />
    <define name="PITCH_SERVO_GAIN" value="0" />
    <define name="YAW_MOTOR_GAIN" value="10" />
    <define name="YAW_COMP_SLOPE" value="0" />
    <define name="YAW_COMP_OFFSET" value="3000" />
  </section>
	   
  <section name="CSC_ACTUATORS" PREFIX="CSC_ACTUATORS_">
    <define name="REMOTE_IDS" value="{1,2,5,6,7,8}" />
  </section>

  <section name="GUIDANCE_V"   prefix="BOOZ2_GUIDANCE_V_">
   <define name="MIN_ERR_Z"    value="POS_BFP_OF_REAL(-10.)"/>
   <define name="MAX_ERR_Z"    value="POS_BFP_OF_REAL( 10.)"/>
   <define name="MIN_ERR_ZD"   value="SPEED_BFP_OF_REAL(-10.)"/>
   <define name="MAX_ERR_ZD"   value="SPEED_BFP_OF_REAL( 10.)"/>
   <define name="HOVER_KP"     value="-500"/>
   <define name="HOVER_KD"     value="-250"/>
   <!-- BOOZ_SPEED_I_OF_F(1.5) / (MAX_PPRZ/2) -->
   <define name="RC_CLIMB_COEF" value ="163"/>
   <!-- BOOZ_SPEED_I_OF_F(1.5) * 20% -->
   <define name="RC_CLIMB_DEAD_BAND" value ="160000"/>
  </section>

  


  <commands>
    <axis name="ROLL"     failsafe_value="0"/>
    <axis name="PITCH"    failsafe_value="0"/>
    <axis name="YAW"    failsafe_value="0"/>
    <axis name="THRUST"    failsafe_value="0"/>
  </commands>

  <section name="IMU" prefix="IMU_">

    <!-- *_s is Xsens.

	phi_s is rotation about z_s
	theta_s rotation about y_s
	psi_s rotation about x_s

	phi   = - phi_s
	theta = theta_s
	psi   = psi_s
	 
	P = Dphi
	Q = Dtheta
	R = Dpsi

      -->
    <define name="GYRO_P_NEUTRAL" value="32665"/>
    <define name="GYRO_Q_NEUTRAL" value="32745"/>
    <define name="GYRO_R_NEUTRAL" value="32447"/>

    <!-- FIXME: this wants GYRO_[P|Q|R]_SENS, defines -->
    <define name="GYRO_P_SENS_NUM" value="(1<<INT32_RATE_FRAC)" />
    <define name="GYRO_Q_SENS_NUM" value="(1<<INT32_RATE_FRAC)" />
    <define name="GYRO_R_SENS_NUM" value="(1<<INT32_RATE_FRAC)" />

    <define name="GYRO_P_SENS_DEN" value="-1174" />
    <define name="GYRO_Q_SENS_DEN" value="1165" />
    <define name="GYRO_R_SENS_DEN" value="1164" />



    <!--  Let x_s,y_s,z_s be the XSens accels, and x,y,z the booz code.

	  x = -z_s
	  y = y_s
	  z = x_s

      -->
    <define name="ACCEL_X_NEUTRAL" value="32285"/>
    <define name="ACCEL_Y_NEUTRAL" value="33240"/>
    <define name="ACCEL_Z_NEUTRAL" value="33029"/>

    <!-- FIXME: this wants ACCEL_[X|Y|Z]_SENS, defines -->
    <define name="ACCEL_X_SENS_NUM" value="(1<<INT32_ACCEL_FRAC)" />
    <define name="ACCEL_Y_SENS_NUM" value="(1<<INT32_ACCEL_FRAC)" />
    <define name="ACCEL_Z_SENS_NUM" value="(1<<INT32_ACCEL_FRAC)" />
    
    <define name="ACCEL_X_SENS_DEN" value="-414" /> 
    <define name="ACCEL_Y_SENS_DEN" value="411" />
    <define name="ACCEL_Z_SENS_DEN" value="416" />

    <!-- We need to think about how to get the magnetometer to
	 reflecct the above coordinate shift. -->
    
    <define name="MAG_X_NEUTRAL" value="32622"/>
    <define name="MAG_Y_NEUTRAL" value="32826"/> 
    <define name="MAG_Z_NEUTRAL" value="32802"/>


    <!-- FIXME: this wants MAG_[X|Y|Z]_SENS, define -->
    <define name="MAG_X_SENS_NUM" value="(1<<11)" />
    <define name="MAG_Y_SENS_NUM" value="(1<<11)" />
    <define name="MAG_Z_SENS_NUM" value="(1<<11)" />

    <define name="MAG_X_SENS_DEN" value="-7730" />
    <define name="MAG_Y_SENS_DEN" value="7576" />
    <define name="MAG_Z_SENS_DEN" value="7757" />

    <define name="BODY_TO_IMU_PHI"   value="ANGLE_BFP_OF_REAL(RadOfDeg(0.))"/>
    <define name="BODY_TO_IMU_THETA" value="ANGLE_BFP_OF_REAL(RadOfDeg(-2.2))"/> 
    <define name="BODY_TO_IMU_PSI"   value="ANGLE_BFP_OF_REAL(RadOfDeg(0.))"/>

  </section>

  

  <section name="MISC">
    <define name="BOOZ2_FACE_REINJ_1"  value="1024"/>
  </section>

  
  <section name="STABILIZATION_RATE" prefix="BOOZ_STABILIZATION_RATE_">

    <define name="SP_MAX_P" value="10000"/>
    <define name="SP_MAX_Q" value="10000"/>
    <define name="SP_MAX_R" value="10000"/>

    <define name="GAIN_P" value="-400"/>
    <define name="GAIN_Q" value="-400"/>
    <define name="GAIN_R" value="-350"/>

  </section>

  <section name="STABILIZATION_ATTITUDE" prefix="BOOZ_STABILIZATION_ATTITUDE_">

    <!-- setpoints -->
    <define name="SP_MAX_PHI"     value="RadOfDeg(45.)"/>
    <define name="SP_MAX_THETA"   value="RadOfDeg(90.)"/>
    <define name="SP_MAX_R"       value="RadOfDeg(90.)"/>
    <define name="DEADBAND_R"     value="250"/>

    <!-- reference -->
    <define name="REF_OMEGA_P"  value="RadOfDeg(800)"/>
    <define name="REF_ZETA_P"   value="0.85"/>
    <define name="REF_MAX_P"    value="RadOfDeg(300.)"/>
    <define name="REF_MAX_PDOT" value="RadOfDeg(7000.)"/>

    <define name="REF_OMEGA_Q"  value="RadOfDeg(800)"/>
    <define name="REF_ZETA_Q"   value="0.85"/>
    <define name="REF_MAX_Q"    value="RadOfDeg(300.)"/>
    <define name="REF_MAX_QDOT" value="RadOfDeg(7000.)"/>

    <define name="REF_OMEGA_R"  value="RadOfDeg(500)"/>
    <define name="REF_ZETA_R"   value="0.85"/>
    <define name="REF_MAX_R"    value="RadOfDeg(180.)"/>
    <define name="REF_MAX_RDOT" value="RadOfDeg(1800.)"/>

    <!-- feedback -->
    <define name="PHI_PGAIN"  value="-400"/>
    <define name="PHI_DGAIN"  value="-300"/>
    <define name="PHI_IGAIN"  value="-100"/>

    <define name="THETA_PGAIN"  value="-400"/>
    <define name="THETA_DGAIN"  value="-300"/>
    <define name="THETA_IGAIN"  value="-100"/>

    <define name="PSI_PGAIN"  value="-380"/>
    <define name="PSI_DGAIN"  value="-320"/>
    <define name="PSI_IGAIN"  value="-75"/>

    <!-- feedforward -->
    <define name="PHI_DDGAIN"   value=" 300"/>
    <define name="THETA_DDGAIN" value=" 300"/>
    <define name="PSI_DDGAIN"   value=" 300"/>

  </section>

  
  <section name="SUPERVISION" prefix="SUPERVISION_">
    <define name="FRONT_ROTOR_CW" value="1"/>
    <define name="MIN_MOTOR" value="2"/>
    <define name="MAX_MOTOR" value="210"/>
    <define name="TRIM_A" value="0"/>
    <define name="TRIM_E" value="0"/>
    <define name="TRIM_R" value="0"/>
  </section>


  <rc_commands>
    <set command="ROLL"     value="@ROLL"/>
    <set command="PITCH"    value="@PITCH"/>
    <set command="YAW"    value="@YAW"/>
  </rc_commands>

    
<makefile>
include $(PAPARAZZI_SRC)/conf/autopilot/mercury.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/csc_baro.makefile
include $(PAPARAZZI_SRC)/conf/autopilot/subsystems/booz2_radio_control_dummy.makefile
</makefile>

</airframe>
